<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet id="create_table_location_role" author="G Wasilwa">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="afyaehms_location_role"/>
            </not>
        </preConditions>

        <comment >
            Create table location role, for linking roles to locations
        </comment>

        <createTable tableName="afyaehms_location_role">

            <column name="location_role_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="preferred" type="tinyint" />

            <column name="location_id" type="int">
                <constraints nullable="false" />
            </column>

            <column name="role_name" type="varchar(50)">
                <constraints nullable="false" />
            </column>

        </createTable>

        <addForeignKeyConstraint baseTableName="afyaehms_location_role" baseColumnNames="location_id"
                                 constraintName="fk_location"
                                 referencedTableName="location" referencedColumnNames="location_id" />
        <addForeignKeyConstraint baseTableName="afyaehms_location_role" baseColumnNames="role_name"
                                 constraintName="fk_role"
                                 referencedTableName="role" referencedColumnNames="role" />
    </changeSet>

    <!--
    <changeSet id="initial_location_role_data" author="G Wasilwa">
        <insert tableName="afyaehms_location_role">
            <column name="location_role_id" valueNumeric="1"/>
            <column name="preferred" valueBoolean="false"/>
            <column name="location_id"/>
            <column name="role" />
        </insert>
    </changeSet>
    -->
</databaseChangeLog>